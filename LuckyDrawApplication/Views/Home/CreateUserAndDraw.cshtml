@model LuckyDrawApplication.Models.User

@{
    ViewBag.Title = "Purchaser Registration";
}

<style>
    .form-control {
        border-radius: 5rem;
        padding: 20px;
        margin: auto;
    }

    input,
    select,
    textarea {
        max-width: 500px;
    }

    .has-error .help-block, .has-error .control-label, .has-error .radio, .has-error .checkbox, .has-error .radio-inline, .has-error .checkbox-inline, .has-error.radio label, .has-error.checkbox label, .has-error.radio-inline label, .has-error.checkbox-inline label {
        color: #ff0000;
        text-align: end;
        border-color: #ff0000;
    }

    .has-error .form-control {
        border-color: #ff0000;
    }

        .has-error .form-control:focus {
            border-color: #ff0000;
        }

    .has-success .form-control {
        border-color: #00d91d;
    }

        .has-success .form-control:focus {
            border-color: #00d91d;
        }

    *, *:before, *:after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    .buttons {
        margin-top: 50px;
        text-align: center;
        margin-bottom: 50px;
    }

    .blob-btn {
        z-index: 1;
        position: relative;
        padding: 20px 46px;
        margin-bottom: 30px;
        text-align: center;
        text-transform: uppercase;
        color: #05004f;
        font-size: 16px;
        font-weight: bold;
        background-color: transparent;
        outline: none;
        border: none;
        transition: color 0.5s;
        cursor: pointer;
    }

        .blob-btn:before {
            content: "";
            z-index: 1;
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            border: 6px solid #05004f;
        }

        .blob-btn:after {
            content: "";
            z-index: -2;
            position: absolute;
            left: 9px;
            top: 9px;
            width: 100%;
            height: 100%;
            border: 6px solid #dfe2e6;
            transition: all 0.3s 0.2s;
        }

        .blob-btn:hover {
            color: #dfe2e6;
        }

            .blob-btn:hover:after {
                transition: all 0.3s;
                left: 0;
                top: 0;
            }

    .blob-btn__inner {
        z-index: -1;
        overflow: hidden;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
    }

    .blob-btn__blobs {
        position: relative;
        display: block;
        height: 100%;
        -webkit-filter: url("#goo");
        filter: url("#goo");
    }

    .blob-btn__blob {
        position: absolute;
        top: 6px;
        width: 25%;
        height: 100%;
        background: #05004f;
        border-radius: 100%;
        -webkit-transform: translate3d(0, 150%, 0) scale(1.7);
        transform: translate3d(0, 150%, 0) scale(1.7);
        transition: -webkit-transform 0.45s;
        transition: transform 0.45s;
        transition: transform 0.45s, -webkit-transform 0.45s;
    }

    supports ((-webkit-filter: url("#goo")) or (filter: url("#goo"))) {
        .blob-btn__blob

    {
        -webkit-transform: translate3d(0, 150%, 0) scale(1.4);
        transform: translate3d(0, 150%, 0) scale(1.4);
    }

    }

    .blob-btn__blob:nth-child(1) {
        left: 0%;
        transition-delay: 0s;
    }

    .blob-btn__blob:nth-child(2) {
        left: 30%;
        transition-delay: 0.08s;
    }

    .blob-btn__blob:nth-child(3) {
        left: 60%;
        transition-delay: 0.16s;
    }

    .blob-btn__blob:nth-child(4) {
        left: 90%;
        transition-delay: 0.24s;
    }

    .blob-btn:hover .blob-btn__blob {
        -webkit-transform: translateZ(0) scale(1.7);
        transform: translateZ(0) scale(1.7);
    }

    supports ((-webkit-filter: url("#goo")) or (filter: url("#goo"))) {
        .blob-btn:hover .blob-btn__blob

    {
        -webkit-transform: translateZ(0) scale(1.4);
        transform: translateZ(0) scale(1.4);
    }
    }
</style>

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://adminlte.io/themes/AdminLTE/bower_components/select2/dist/css/select2.min.css" rel="stylesheet" />

<!-- Site wrapper -->
<div class="wrapper">

    @Html.Partial("_SalesConsultantLayout")

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">

        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1 style="margin: 20px;">Purchaser Registration</h1>
            <ol class="breadcrumb">
                <li><a href="~/Home/Index"><i class="fa fa-dashboard"></i>Dashboard</a></li>
                <li class="active">Registration</a></li>
            </ol>

        </section>


        <!-- Main content -->
        <section class="content">

            <!-- Default box -->
            <div class="box box-primary">

                <!-- User Registration Form -->
                <form id="register_user" method="post" class="form-horizontal" action="" style="text-align:center; padding-top: 50px; padding-bottom: 20px;">

                    <div class="login-logo">
                        <b>LuckyWheel</b><small>Purchasers</small>
                    </div>

                    <h4 style="font-weight:bold">Register A New Purchaser and Try Your Luck!</h4>

                    <div class="row text-center" style="margin-top: 50px;">

                        <div class="col-lg-6 col-lg-offset-3 col-md-8 col-md-offset-2 col-sm-offset-1 col-offset-xs-0 col-xs-12 col-sm-10">

                            <!-- Full Name -->
                            <div class="form-group text-center center-block">
                                <label class="col-md-2" for="name" style="text-align:left;padding: 10px;">Name</label>
                                <div class="col-md-10" style="margin:auto;">
                                    <input type="text" class="form-control form-rounded" id="name" name="name" placeholder="" />
                                </div>
                            </div>

                            <!-- IC Number -->
                            <div class="form-group">
                                <label class="col-md-2" for="ic_number" style="text-align:left;padding: 10px;">IC No</label>
                                <div class="col-md-10">
                                    <input type="text" class="form-control form-rounded" id="ic_number" name="ic_number" placeholder="Eg. 7802053550786" />
                                </div>
                            </div>

                            <!-- Email Address -->
                            <div class="form-group">
                                <label class="col-md-2" for="emailaddress" style="text-align:left;padding: 10px;">Email</label>
                                <div class="col-md-10">
                                    <input type="email" class="form-control form-rounded" id="emailaddress" name="emailaddress" placeholder="Eg. ram@gmail.com" />
                                </div>
                            </div>

                            <!-- Contact Number -->
                            <div class="form-group">
                                <label class="col-md-2" for="contactnumber" style="text-align:left;padding: 10px;">Contact No</label>
                                <div class="col-md-10">
                                    <input type="text" class="form-control form-rounded" id="contactnumber" name="contactnumber" placeholder="Eg. 0166176814" />
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-md-2" for="project" style="text-align:left;padding: 10px;">Project</label>
                                <div class="col-md-10">
                                    @Html.DropDownList("project", (IEnumerable<SelectListItem>)ViewBag.ProjectList, new { @class = "form-control" })
                                </div>
                            </div>

                            <!-- Block -->
                            <div class="form-group">
                                <label class="col-md-2" for="unit" style="text-align:left;padding: 10px;">Block</label>
                                <div class="col-md-10">
                                    <input type="text" class="form-control form-rounded" id="block" name="block" placeholder="Eg. A" />
                                </div>
                            </div>

                            <!-- Level -->
                            <div class="form-group">
                                <label class="col-md-2" for="salesconsultant" style="text-align:left;padding: 10px;">Level</label>
                                <div class="col-md-10">
                                    @Html.DropDownList("level", new SelectList(ViewBag.FloorUnitList, "Text", "Value"), new { @class = "form-control form-rounded" })
                                </div>
                            </div>

                            <!-- Unit -->
                            <div class="form-group">
                                <label class="col-md-2" for="salesconsultant" style="text-align:left;padding: 10px;">Unit</label>
                                <div class="col-md-10">
                                    @Html.DropDownList("unit", new SelectList(ViewBag.FloorUnitList, "Text", "Value"), new { @class = "form-control form-rounded" })
                                </div>
                            </div>

                            <!-- Sales Consultant -->
                            <div class="form-group">
                                <label class="col-md-2" for="salesconsultant" style="text-align:left;padding: 10px;">Sales Consultant</label>
                                <div class="col-md-10">
                                    <input type="text" class="form-control form-rounded" id="salesconsultant" name="salesconsultant" placeholder="" />
                                </div>
                            </div>

                            <!-- Sales Location -->
                            <div class="form-group">
                                <label class="col-md-2" for="saleslocation" style="text-align:left;padding: 10px;">Sales Location</label>
                                <div class="col-md-10">
                                    <input type="text" class="form-control form-rounded" id="saleslocation" name="saleslocation" value="@ViewBag.SalesLocation" readonly />
                                </div>
                            </div>

                        </div>

                    </div>

                    <div class="row text-center" style="margin-top:25px">
                        <div class="buttons">
                            <button class="blob-btn" type="submit" name="register" value="Register and Draw">
                                REGISTER ME AND SPIN THE LUCKY WHEEL!
                                <span class="blob-btn__inner">
                                    <span class="blob-btn__blobs">
                                        <span class="blob-btn__blob"></span>
                                        <span class="blob-btn__blob"></span>
                                        <span class="blob-btn__blob"></span>
                                        <span class="blob-btn__blob"></span>
                                    </span>
                                </span>
                            </button>
                        </div>
                    </div>

                </form>

            </div>

        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->

    @Html.Partial("_Footer")

</div>


<script src="https://adminlte.io/themes/AdminLTE/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="~/admin-lte/js/adminlte.min.js"></script>
<script src="~/Scripts/jquery-3.3.1.min.js"></script>
<script src="~/Scripts/jquery.validate.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>


<script type="text/javascript">

    $(document).ready(function () {

        $('#register').addClass("active");

        level.SelectedValue = "1";
        unit.SelectedValue = "1";

        $("#register_user").validate({
            rules: {
                name: {
                    required: true,
                    validAlpha: true,
                    minlength: 3,
                    max50: true
                },
                ic_number: {
                    required: true,
                    validNo: true,
                    validIC: true
                },
                emailaddress: {
                    required: true,
                    minlength: 3,
                    max50: true
                },
                contactnumber: {
                    required: true,
                    validNo: true,
                    minlength: 9,
                    max15: true
                },
                block:
                {
                    required: true,
                    max50: true
                },
                salesconsultant: {
                    required: true,
                    validAlpha: true,
                    minlength: 3,
                    max50: true
                }
            },
            submitHandler: function (form) {
                var prizeWon = 0;
                var json = {
                    'Name': form.name.value,
                    'ICNumber': form.ic_number.value,
                    'EmailAddress': form.emailaddress.value,
                    'ContactNumber': form.contactnumber.value,
                    'EventID': '',
                    'ProjectID': form.project.value,
                    'Unit': form.block.value + "-" + form.level.value + "-" + form.unit.value,
                    'SalesConsultant': form.salesconsultant.value,
                    'SalesLocation': '@ViewBag.SalesLocation',
                    'PrizeWon': prizeWon
                };
                $.ajax({
                    url: '@Url.Action("CreateUserAndDraw", "Home")',
                    method: 'POST',
                    data: JSON.stringify(json),
                    dataType: 'json',
                    contentType: 'application/json',
                    processData: false,
                    success: function (data) {

                        if (data.success) {

                            alert("You will be redirected shortly!");
                            $('#register_user')[0].reset();

                            var linkHref = data.urllink;
                            window.open(linkHref);
                        }

                        else {
                            alert(data.message);
                        }

                    },
                    error: function (data) {
                        alert(data.message);
                    }
                });
            },
            errorElement: "em",
            errorPlacement: function (error, element) {
                // Add the `help-block` class to the error element
                error.addClass("help-block");
                error.insertAfter(element);
            },
            highlight: function (element, errorClass, validClass) {
                $(element).parents(".col-md-10").addClass("has-error").removeClass("has-success");
            },
            unhighlight: function (element, errorClass, validClass) {
                $(element).parents(".col-md-10").addClass("has-success").removeClass("has-error");
            },
        });

        jQuery.validator.addMethod("validIC", function (value, element) {
        return value.length == 12;
        }, "This field must be exactly 12 characters long");

        jQuery.validator.addMethod("max50", function (value, element) {
            return value.length < 50;
        }, "This field must be less than 50 characters");

        jQuery.validator.addMethod("max15", function (value, element) {
            return value.length < 15;
        }, "This field must be less than 15 characters");

        jQuery.validator.addMethod("validNo", function (value, element) {
        return !(isNaN(value));
        }, "This field must be only contain numerical characters");

        jQuery.validator.addMethod("validAlpha", function (value, element) {
            return (isNaN(value));
        }, "This field must be only contain alphabetical characters");

    });

</script>